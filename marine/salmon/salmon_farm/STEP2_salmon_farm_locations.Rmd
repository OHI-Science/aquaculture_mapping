---
title: "Location of Salmon Farms"
author: "Gage Clawson (UCSB, NCEAS, OHI)"
date: "10/28/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

This script standarizes location of salmon farms to be lat/long point data.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(raster)
library(tidyverse)
library(stringr)
library(rgdal)
library(PBSmapping)
library(maptools)
library(sf)
library(lwgeom)
library(data.table)
library(here)
library(mapview)

path <- "/home/shares/food-systems/Food_footprint/_raw_data/Aquaculture_locations"
fao_salmon <- read_csv("marine/salmon/salmon_farm/data/fao_mariculture_salmon.csv") %>%
     dplyr::filter(year == 2017) 

sort(unique(fao_salmon$country))


#  [1] "Australia"                "Canada"                   "Chile"                    "Denmark"                 
#  [5] "Faroe Islands"            "Finland"                  "Iceland"                  "Ireland"                 
#  [9] "Japan"                    "New Zealand"              "Norway"                   "Russian Federation"      
# [13] "Sweden"                   "Turkey"                   "United Kingdom"           "United States of America"
```

# Raster

Standard raster used for this analysis 

```{r}

source(here("_spatial/template_raster.R"))

```


# Global regions

```{r}

gadm <- raster("/home/shares/food-systems/Food_footprint/_raw_data/Country_regions/gadm36mol_pyfill_10km.tif")

gadm_latlon <- projectRaster(gadm, food_raster)

gadm_codes <- read.csv("/home/shares/food-systems/Food_footprint/_raw_data/Country_regions/gadm_reg_codes.csv") %>% 
  mutate(reg_id = as.numeric(reg_id))

```

```{r}

gadm_df <- tabularaster::as_tibble(gadm_latlon, value = TRUE, cells = TRUE) %>% 
  mutate(cellvalue = round(cellvalue, 0))

gadm_reg <- dplyr::left_join(gadm_df, gadm_codes, by = c("cellvalue" = "reg_id"))

```

Now we will map the remaining countries with shrimp farms. Workflow will be as follows: 
 - Try to obtain exact locations of farms from published source or dataset (such as FAO or a research paper)
 - If there are not exact locations or comprehensive locations, find the number of farms. 
 - If there is no information at all, note it. 
 
For each point, we will add a column for "data quality". It will be scored as very good (5), good (4), fair (3), bad (2), and very bad (1). 
 5: Comprehensive number of exact farms 

4: Subset of exact locations, need to add a specific number of farms to existing locations. 
  - country|species|farm locations
  - country|species|additional points

3: A specific number of farms are known, but no locations 
 - country|species|additional points

2: Exact locations are a subset of total farms. But the number of total farms are unknown. Need to be gapfilled by tonnage. 

1: No information on number of farms at all. Need to be gapfilled by tonnage. 
 - country|species|# additional farms (this will be NA)

# Chile

Data for Chile comes from https://mapas.subpesca.cl/ideviewer/?locale=en-gb. 

There is also a list of concessions here: http://www.subpesca.cl/portal/619/w3-article-92935.html

I was in contact with Valeria Tamayo at UCSB who helped me with some spanish translations concerning this data.

Source:
Undersecretariat for Fisheries and Aquaculture, 2020. [Accessed Feb 2020] https://mapas.subpesca.cl/ideviewer/?locale=en-gb

```{r}

# Column meaning and names
#0 LINK_DOC - URL of the SUBPESCA resolution approving the aquaculture or resolution technical project that cartographically regulates the aquaculture concession
#1 CARTA - Name of the geographic reference letter
#2 DATUM - Reference datum name
#3 HUSO - Spindle Name
#4 COMUNA - Name of the commune
#5 N_PERT - Pert number, code of the application for admission to process
#6 N_CODIGOCE - Farming center code according to the national aquaculture registry
#7 N_RESOLSSP - Resolution number of the undersecretary of fisheries and aquaculture that apprehends the aquaculture technical project
#8 F_RESOLSSP - Date of issuance of the resolution of the undersecretary of fisheries and aquaculture approving the aquaculture technical project
#9 N_RESOLSSF - Resolution number of the undersecretary for the armed forces granted by the aquaculture concession
#10 F_RESOLSSF - Date of issuance of the resolution of the undersecretary for the armed forces granted by the aquaculture concession
#11 TOPONIMIO - Geographical location of the aquaculture concession
#12 ESPECIES - Name of crop species
#13 AGRUPCONCE - Identifier of the salmonid concession group or sanitary neighborhood
#14 SUPERFICIE - Surface in hectares
#15 TITULAR - Name of the holder of the aquaculture concession
#16 COORDENADS - List of geographical coordinates of the aquaculture concession corresponding to each of the vertices of the polygon
#17 REGION - Region name
#18 GRUPO_ESP - Group of crop species
#19 TIPO_PORCI - Type of space where the aquaculture concession is located
#20 ESTADO - Processing status of the aquaculture concession
#21 ESTADO_SOL - Status of the aquaculture application process


chile_dat <- st_read(file.path(path, "Chile"), layer = "Concesiones_de_Acuicultura")

```

We filter to only those that produce salmon, but note that this is ALL leases, not neccesarily only active sites. 
```{r}

#Filter to only salmon farming
chile <- chile_dat %>% 
  filter(grepl("SALMON", REP_SUB_13)) 

# convert polygons to points
chile_pts <- st_centroid(chile)
chile_pts <- st_transform(chile_pts, food_crs)

# save as a dataframe
farms_chile <- data.frame(do.call(rbind, st_geometry(chile_pts))) 
names(farms_chile) <- c("lon", "lat")
farms_chile <- farms_chile %>%
  mutate(iso3c="CHL") %>%
  mutate(data_quality = 5) 

write_csv(farms_chile, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_chile.csv"))

```


# Norway

We use the number of salmon licenses to get a proxy for the relative distribution of production along the Norwegian coast. 
†
## Load csv with lat long
Comprehensive License data.

Source: 
Fiskeridirektoratet, 2019. 2019 aquaculture license data. [accessed May 2019] https://fiskeridir.no/Akvakultur/Registre-og-skjema/Akvakulturregisteret

```{r}

enc <- readr::guess_encoding(file.path(path, "Norway/Akvakulturregisteret.csv"), n_max = 1000)[,"encoding"] %>% as.character()

norway_csv <- read.csv(file = file.path(path, "/Norway/Akvakulturregisteret.csv"), skip = 1, header = TRUE, sep = ";", fileEncoding = enc)


#Variable translations
#Akvakulturregisteret – variables:
#TILL_NR - License number
#ORG.NR/PERS.NR - Company official number
#NAVN - company name
#ADRESSE - address
#POSTNR - post number
#POSTSTED - regional center
#TILDELINGSTIDSPUNKT - date that the license got accepted
#TIDSBEGRENSET - time bound of license
#TILL_KOMNR - license municipality number
#TILL_KOM - License municipality
#FORMÅL - purpose of use - Purpose (you probaly want "kommersiell" =commercial)
#PRODUKSJONSFORM - Production form (Matfisk = grow out)
#ART - Species (Laks=salmon, ørret=trout, regnbueørret = rainbow trout)
#TILL_KAP - Maximum allowed biomass for the license - some kind of capacity
#TILL_ENHET - units of measure (TN = ton, KG = kilogram)
#LOK_NR - Location number (identifies actual group of pens)
#LOK_NAVN - Location name
#LOK_KOMNR - Location municipality number
#LOK_KOM - Location municipality
#LOK_PLASS - Location place (land or sea) - sea 
#VANNMILJØ - Water environment (freshwater, saltwater or both) - saltvann and freskvann/saltvann
#LOK_KAP - Location max allowed biomass
#LOK_ENHET - 
#N_GEOWGS84 - GPS North
#Ø_GEOWGS84 - GPS East

```

We filter the data to only include commercial marine salmon production. We also only include farms that are growing salmon for food.

The dataset also has rows with the same lat/lon coordinates, so we only use unique lat/lon after filtering to get single points for each location. 

http://www.fao.org/fishery/countrysector/naso_norway/en
"By the end of 2003, 832 licences for ongrowing in sea water".  And 1,018 here (includes salmon and rainbow trout): https://www.ssb.no/en/statbank/table/08967/tableViewLayout1/. 
I get a similar value of 893 by including all years to 2013 and removing duplicate regions.  So, I am assuming that most of these licenses in these data are active.  Regardless, this should provide a reasonable estimate of production distribution. 

For 2018 (https://www.ssb.no/en/statbank/table/08967/tableViewLayout1/) including salmon and rainbow trout: 1,160
These data have 920 licenses for salmon only. These values seem reasonably aligned to me.  I am using this information to make sure these data do not include inactive licenses, how to best account for multiple license listings at the same location (conclusion: count only once), and whether we need to subset by year enacted (no).

```{r}

#FORMAL = Kommersiell, Slaktemerd, 
unique(norway_csv$FORMÅL)

#Kommersiell = Commerical
#Forskning = Research
#Slaktemerd  = Slaughter  cage             
#Fangstbasert akvakultur = Catch-based aquaculture, i.e., wild caught fish are stored in pens to hold them until prices increase during non-fishing season, https://www.sciencedirect.com/science/article/pii/S0308597X18302252
#Undervisning    =  Teaching
#Manntall =   Census            
#Visning =  Display
# Fiskepark = Fishpark
# Utvikling = Development

unique(norway_csv$PRODUKSJONSFORM)

#MATFISK = food fish                             
#SETTEFISK  = hatcheries                        
#STAMFISK = broodstock                         
#STAMDYR = broodstock                            
#AKVAKULTURDYR I TIDLIGE LIVSSTADIER =AQUACULTURE ANIMALS IN EARLY LIFE STAGES
#AKVAKULTURDYR TIL KONSUM = AQUACULTURE ANIMALS FOR CONSUME          
#MATFISK-GRØNN KONVERTERT = FOOD FISH GREEN CONVERTED         
#MATFISK-GRØNN A  = Food fish green A              
#MATFISK - (5% MTB ØKNING)  = FOOD - (5% MTB INCREASE)         
#ALGER TIL  fôr/konsum    = ALGER FOR FOOD / CONSUMPTION
#SKALLDYR   = SHELLFISH
#ANDRE FORMÅL   = Other objective                     
#MATFISK-GRØNN C = Food fish green C                    
#ALGER TIDLIG FASE  = ALGER EARLY PHASE
#HAVBEITE = ranching                           
#MATFISK-GRØNN B   = food fish green B                 
#ØKOLOGISK MATFISK   =  organic food fish                
#MATFISK-GRØNN A (5% MTB ØKNING) = FOOD FISH GREEN A (5% MTB INCREASE

unique(norway_csv$ART)
species <- "Laks"

unique(norway_csv$VANNMILJØ)
# FERSKVANN = freshwater
# BRAKKVANN = brackishwater
# SALTVANN = saltwater

# Only include Commercial production
purpose <- c("Kommersiell")

#Only include salmon for food
objective <- c("MATFISK", "AKVAKULTURDYR TIL KONSUM", "MATFISK-GRØNN KONVERTERT", "MATFISK - (5% MTB ØKNING)", "MATFISK-GRØNN C", "HAVBEITE", "MATFISK-GRØNN B", "ØKOLOGISK MATFISK", "MATFISK-GRØNN A (5% MTB ØKNING)")

# Subset
sub_norway <- norway_csv %>% 
  filter(ART == species,
         FORMÅL %in% purpose,
         PRODUKSJONSFORM %in% objective,
         VANNMILJØ %in% c("SALTVANN")) #only 1 FERSKVANN/SALTVANN, not going to have a large effect on results if we cut/include


#There are multiple liscenses for the same place.  This may be for multiple pens or across time.  
# We will count them as one location given that the data then match well with other sources
sub_norway %>%  
arrange(N_GEOWGS84, Ø_GEOWGS84)


farms_nor <- sub_norway %>% 
  distinct(lon=Ø_GEOWGS84, lat=N_GEOWGS84, iso3c="NOR") %>% # Counting duplicate liscense locations once
  mutate(data_quality = 5)

write_csv(farms_nor, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_nor.csv"))

norway <- read_csv(here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_nor.csv"))

norway_sf <- st_as_sf(norway, coords = c("lon", "lat"), 
                         crs = crs(gadm_latlon), agr = "constant")

mapview(norway_sf)

```



# Scotland
 - Comprehensive data 

Based on these data for the UK region, it appears that salmon aquaculture is occurring only in Scotland. 

```{r}


## another dataset for entire UK region
## want to make sure salmon aquaculture is occurring only in Scottland in UK
test <- st_read("/home/shares/food-systems/Food_footprint/_raw_data/Aquaculture_locations/UK/EMOD/EMODnet_HA_Aquaculture_Marine_Finfish_20190104.shp") %>%
  filter(COUNTRY == "United Kingdom",
         SALMON == "Yes", 
         STATUS == "Active")
## based on plot, this is all in Scottland.

mapview(test)
```


Source: 
http://aquaculture.scotland.gov.uk/
```{r}
## get scotland data: http://aquaculture.scotland.gov.uk/
# Load in data and select sites that have been producing in the last 3 years

#### TODO #### This could probably be improved by setting up a way to webscrape these data... not sure how this was compiled previously. 

scotland_csv <- as.data.frame(read_csv(file.path(path, "Scotland/Scotland_site_details.csv")))


# Subset to salmon farms
sub_scotland <- scotland_csv %>% 
  dplyr::select(ID = `Marine Scotland Site ID`, Easting, Northing, `Producing in Last 3 Years`, `Aquaculture Type`, `Water Type`, Species, subregion = `Local Authority` ) %>% 
  filter(`Producing in Last 3 Years` == c("Yes", "New"),
         `Water Type` %in% c("Seawater", "Freshwater and Seawater"), 
         grepl("Salmon", Species))

new_names <- data.frame(subregion = c("Argyll and Bute", "North Ayrshire", "Western Isles", "Shetland", "Orkney", "Highland"),
                         subregion_new = c("Argyll & Clyde", "Argyll & Clyde", "Outer Hebrides", "Shetland Isles", "Orkney Islands", 
                                       "North Coast & West Highlands"))

sub_scotland <- sub_scotland %>%
  left_join(new_names, by="subregion") %>%
  dplyr::select(Easting, Northing, subregion = subregion_new)

coordinates(sub_scotland) <- cbind(sub_scotland$Easting, sub_scotland$Northing)
crs(sub_scotland) <- "+init=epsg:7405"
scotland <- spTransform(sub_scotland, CRS('+init=epsg:4326'))

scotland <- st_as_sf(scotland) %>% st_zm()

farms_scotland <- data.frame(do.call(rbind, st_geometry(scotland))) 
names(farms_scotland) <- c("lon", "lat")

farms_scotland$subregion <- sub_scotland$subregion
farms_scotland <- farms_scotland %>%
  mutate(iso3c = "GBR") %>%
  mutate(data_quality = 5)

write_csv(farms_scotland, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_scotland.csv"))

```


# Faroe Islands

We consider Faroe Islands as a single region. We have data from ASC to use for our farms.

 - Even though it is ASC, all indications point to that it is comprehensive. 

Source: 
Aquaculture Stewardship Council Data Mapping Study, n.d. Aquaculture Stewardship Council. [Accessed November 11, 2020] 
https://gis.asc-aqua.org/arcgis_app/


```{r}
ASC_salmon_sf <- st_read(file.path("/home/shares/food-systems/Food_footprint/_raw_data/Aquaculture_locations/ASC_data/ASC_all_sf.shp"))

fro_salmon_sf <- ASC_salmon_sf %>%
  dplyr::filter(crt_cnt == "Faroe Islands") 

mapview(fro_salmon_sf)

fro_pts <- st_centroid(fro_salmon_sf)

fro_pts_latlon <- st_transform(fro_pts, crs = "+init=epsg:4326") %>% 
  dplyr::select(geometry) %>%
  mutate(iso3c = "FRO")

farms_fro <- data.frame(do.call(rbind, st_geometry(fro_pts_latlon))) 
names(farms_fro) <- c("lon", "lat")
farms_all_fro <- farms_fro %>%
  cbind(iso3c = fro_pts_latlon$iso3c) %>%
  mutate(data_quality = 5) 

write_csv(farms_all_fro, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_fro.csv"))

```


# Australia

 - Comprehensive data 
 
Data is from the national map (https://nationalmap.gov.au/#share=s-9CWx9q1BlcDp56T59yiCGgZDU3Q). Instructions on how to access raw data are here: https://nationalmap.gov.au/help/help.html.

Julia Blanchard's RA helped extract the data by manually going through the map and selecting individual farm leases to record their locations, then reading the DPIPWE documentation to identify the species farmed at each location.

According to this source: https://data.gov.au/dataset/ds-dga-c12a0597-b535-48b3-a602-1f8382d8dae6/details
In 2015-2016, >98% of salmonid aquaculture was in Tasmania.  So limiting to Tasmania is probably fine.

TODO: 
There is probably a way to automate this by web scraping, like we did for Australia tuna aquaculture. 


Source: 
Tasmanian Government Department of Primary Industries, Parks, Water and Environment, 2019. Sea fishing & aquaculture. [Accessed Jun 2019] https://dpipwe.tas.gov.au/sea-fishing-aquaculture/marine-farming-aquaculture 

Australian Government National Map, 2019. Marine framing zones. [accessed June 2019]
https://nationalmap.gov.au/#share=s-9CWx9q1BlcDp56T59yiCGgZDU3Q

```{r}

#Tasmania
tas_csv <- read.csv(file = file.path(path, "/Australia/NationalMap_AquacultureFarms.csv"), header = T)


farms_tas <- tas_csv %>% 
  filter(species_farmed1 == "salmon" | species_farmed2 == "salmon" | species_farmed3 == "salmon") %>%
  dplyr::select(lon, lat) %>%
  mutate(iso3c="AUS") %>%
  mutate(data_quality = 5) 


write_csv(farms_tas, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_tas.csv"))

```


# Canada
TODO: This could probably updated with more current data. 


An annual average of 122,300 tonnes of salmon was produced in the last five years (2011-2015). Salmon has represented an average of 70% of total Canadian aquaculture volume. British Columbia’s salmon production represents over 60% of this total. (https://www.dfo-mpo.gc.ca/aquaculture/sector-secteur/species-especes/salmon-saumon-eng.htm).

These data suggest production occurs in: Nova Scotia, New Brunswick, and BC.

British Colombia data with species information: https://catalogue.data.gov.bc.ca/dataset/saltwater-finfish-tenures-coastal-resource-information-management-system

PEI data is available, but no salmon: http://www.arcgis.com/home/webmap/viewer.html?webmap=16aa8830c7084a8a92ce066b525978b4

Newfoundland and Labrador data was extracted from figures found on the web: https://www.fishaq.gov.nl.ca/aquaculture/index.html
(sites are for 2015)


## British colombia

 - Comprehensive data

Source: 
Saltwater Finfish Tenures - Coastal Resource Information Management System (CRIMS) , 2019. Ministry of Forests, Lands, Natural Resource Operations and Rural Development. [Accessed January 17, 2020] https://catalogue.data.gov.bc.ca/dataset/saltwater-finfish-tenures-coastal-resource-information-management-system

```{r}


bc <- st_read(file.path(path, "Canada/CRIMS_S_WATER_FINFISH_TENURES/WAT_FNF_TN_polygon.shp"))


bc_pts <- st_centroid(bc)

bc_pts_latlon <- st_transform(bc_pts, crs = "+init=epsg:4326") %>% 
  dplyr::select(geometry)

farms_bc <- data.frame(do.call(rbind, st_geometry(bc_pts_latlon))) 
names(farms_bc) <- c("lon", "lat")
farms_bc <- farms_bc %>%
  mutate(iso3c="CAN") %>%
  mutate(data_quality = 5)

write_csv(farms_bc, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_bc_can.csv"))

```


## New Brunswick

 - Comprehensive data
 
Source: 
NB Agriculture, Aquaculture and Fisheries, 2019. Finfish. [Accessed Oct 2019]
https://hub.arcgis.com/datasets/DAAF-MAAP::masmps-data

```{r}

nb <- st_read(file.path(path,"/Canada/New_brunswick_Finfish_mol.shp"))
mapview(nb)
nb_pts <- st_centroid(nb)

nb_pts_latlon<-st_transform(nb_pts, crs = "+init=epsg:4326") %>% 
  dplyr::select(geometry)

farms_nb <- data.frame(do.call(rbind, st_geometry(nb_pts_latlon))) 
names(farms_nb) <- c("lon", "lat")
farms_nb <- farms_nb %>%
  mutate(iso3c="CAN") %>%
  mutate(data_quality = 5)

write_csv(farms_nb, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_nb_can.csv"))

```


## Nova Scotia
Originally tried using points along the entire coastline.  But this was far too many points.  Here is a good site:
https://www.nsgc.gov.ns.ca/fishaqua/provinceSalmon.htm (other aquaculture species also available).

Obtained data from here: https://data.novascotia.ca/Fishing-and-Aquaculture/Aquaculture-License-and-Lease-GIS-Database/h57h-p9mm
(Feb 18 2020)

 - Comprehensive data

Source: 
Nova Scotia Marine Aquaculture Leases , 2020. Nova Scotia Fisheries and Aquaculture. [Accessed February 18, 2020] https://data.novascotia.ca/Fishing-and-Aquaculture/Nova-Scotia-Marine-Aquaculture-Leases/h57h-p9mm

```{r}

ns <- st_read(file.path(path,"Canada/Nova_Scotia_Marine_Aquaculture_Sites/geo_export_fcc6f2ef-82bb-4445-98f0-a82a56cd0d00.shp"))
mapview(ns)
# id salmon
salmon <- grep("Salmon|salmon", unique(ns$aqua_speci), value=TRUE)

ns_salmon <- ns %>%
  filter(aqua_speci %in% salmon)

ns_salmon_mol <- st_transform(ns_salmon, crs = "+init=epsg:3035") # convert to equal area projection to find centroids. 
ns_pts <- st_centroid(ns_salmon_mol)

ns_pts_latlon <- st_transform(ns_pts, crs = "+init=epsg:4326") 

mapview(ns_pts_latlon)

farms_ns <- data.frame(do.call(rbind, st_geometry(ns_pts_latlon))) 
names(farms_ns) <- c("lon", "lat")
farms_ns <- farms_ns %>%
  mutate(iso3c="CAN") %>%
  mutate(data_quality = 5)

write_csv(farms_ns, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_ns_can.csv"))

```


## Newfoundland and Labrador

 - Comprehensive data
  
Source: 
Newfoundland Labrador Fisheries, Forestry and Agriculture, 2015. [Accessed February 18, 2020] https://www.gov.nl.ca/flr/lands/ownership/commercial/aquaculture/

```{r}

new_lab <- read.csv(file.path(path,"Canada/NewFoundland_Labrador/NewFoundland_Labrador_salmon.csv"))


farms_new_lab <- new_lab %>%
  mutate(iso3c = "CAN") %>%
  dplyr::select(lon, lat, iso3c) %>%
  mutate(data_quality = 5) 
 
write_csv(farms_new_lab, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_new_lab_can.csv"))

```


# United States
Salmon aquaculture occurs along the Atlantic coast and in Puget sound.

Puget Sound data (2018 data): http://www.moldychum.com/violations-prompt-washington-state-cancel-atlantic-salmon-farm-lease/


## Puget Sound

Source: 
Our Sound, Our Salmon, 2017. [Accessed January 31, 2020] http://www.moldychum.com/violations-prompt-washington-state-cancel-atlantic-salmon-farm-lease/

 - NOT comprehensive, existing points need gapfilling

```{r}

farms_ps <- read.csv(file.path(path, "USA/PugetSound/USA_PugetSound_AtSalmon.csv")) %>%
  mutate(iso3c = "USA") %>%
  dplyr::select(lon, lat, iso3c) %>%
  mutate(data_quality = 2) 

write_csv(farms_ps, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_ps_usa.csv"))

```

## US Northeast
Source:
Northeast Regional Ocean Council, 2018. Northeast ocean data: aquaculture. [Accessed January 17, 2020] 

 - NOT comprehensive, existing points need gapfilling
 
```{r}

us_ne <- st_read(file.path(path,"USA/NE/US_NE_Aquaculture.shp"))


# id salmon and active sites
salmon_species <- grep("Salmon|salmon", unique(us_ne$allSpecies), value=TRUE)

us_ne_salmon <- us_ne %>%
  filter(allSpecies %in% salmon_species) %>%
  filter(status == "Active")

us_ne_salmon_mol <- st_transform(us_ne_salmon, crs = "+init=epsg:3035") # convert to equal area projection to find centroids. 
us_ne_salmon_pts <- st_centroid(us_ne_salmon_mol)
# check
plot(st_geometry(us_ne_salmon_mol))
plot(st_geometry(st_centroid(us_ne_salmon_mol)), add=TRUE)

us_ne_salmon_pts_latlon <- st_transform(us_ne_salmon_pts, crs = "+init=epsg:4326") 

farms_us_ne <- data.frame(do.call(rbind, st_geometry(us_ne_salmon_pts_latlon))) 
names(farms_us_ne) <- c("lon", "lat")
farms_us_ne <- farms_us_ne %>%
  mutate(iso3c = "USA") %>%
  mutate(data_quality = 2)

write_csv(farms_us_ne, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_ne_usa.csv"))

```

# New Zealand

We use the data from ASC for our New Zealand farms. 

Source: 
Aquaculture Stewardship Council Data Mapping Study, n.d. . Aquaculture Stewardship Council. [Accessed November 11, 2020] 
https://gis.asc-aqua.org/arcgis_app/

 - comprehensive (need to add to existing points) - We need add 22 points to existing 1 (a final total 23 of  points)
 
http://www.fao.org/fishery/countrysector/naso_newzealand/en
“There were 23 king salmon farms in 2004 occupying 60 hectares of water space and producing 7 400 tonnes of fish (NZAC, 2005). Most of these farms were located in marine waters in the Marlborough Sounds, and Stewart Island, but also a smaller number in freshwater in hydroelectric water channels”


```{r}
ASC_salmon_sf <- st_read(file.path("/home/shares/food-systems/Food_footprint/_raw_data/Aquaculture_locations/ASC_data/ASC_all_sf.shp"))

nzl_salmon_sf <- ASC_salmon_sf %>%
  dplyr::filter(crt_cnt == "New Zealand") %>%
  dplyr::filter(spcs__c == "Salmon")

mapview(nzl_salmon_sf)

nzl_pts <- st_centroid(nzl_salmon_sf)

nzl_pts_latlon <- st_transform(nzl_pts, crs = "+init=epsg:4326") %>% 
  dplyr::select(geometry) %>%
  mutate(iso3c = "NZL")

farms_nzl <- data.frame(do.call(rbind, st_geometry(nzl_pts_latlon))) 
names(farms_nzl) <- c("lon", "lat")
farms_all_nzl <- farms_nzl %>%
  cbind(iso3c = nzl_pts_latlon$iso3c) %>%
  mutate(data_quality = 4)

write_csv(farms_all_nzl, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_nz.csv"))

## Now we will make a file that tells us the number of additional farms that need to be added to be comprehensive
nz_additional <- data.frame(iso3c = "NZL", type = "salmon", num_additional_farms = 22, data_quality = 4)
write.csv(nz_additional, here("marine/salmon/salmon_farm/data/subset_known_add_points_4/add_farms_nz.csv"), row.names = FALSE)

```


# Ireland
Downloaded from here (Jan 31 2020): https://www.agriculture.gov.ie/seafood/engineering/publications/gisdata/

 - Comprehensive data 
 
Source:
Ireland Department of Agriculture, Food and the Marine., 2019. Aquaculture licence GIS data. [accessed January 31, 2020]  https://www.agriculture.gov.ie/seafood/engineering/publications/gisdata/

```{r}

ireland <- st_read(file.path(path,"Ireland/AquacultureLicenceGISData23122019/Aqua_Sites_Redacted_23-12-2019.shp"))

ire_salmon <- ireland %>%
  dplyr::filter(Species_Na %in% "Salmon")

ire_pts <- st_centroid(ire_salmon)

ire_pts_latlon <- st_transform(ire_pts, crs = "+init=epsg:4326") 

farms_ire <- data.frame(do.call(rbind, st_geometry(ire_pts_latlon))) 
names(farms_ire) <- c("lon", "lat")
farms_ire <- farms_ire %>%
  mutate(iso3c="IRL") %>%
  mutate(data_quality = 5) 

write_csv(farms_ire, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_ire.csv"))

```


# Russia

https://salmonbusiness.com/russian-aquaculture-harvested-over-over-17000-tonnes-of-fish-last-year/

https://www.intrafish.com/finance/russian-aquaculture-sets-huge-salmon-production-target-as-earnings-spike/2-1-662980

Russian Aquaculture is the only in Russia company farming Atlantic salmon. The company has 49 sites for salmon and trout farming in the Barents and the White Seas and in Karelia (Trout), with annual potential production capacity of around 50,000 metric tons of salmonids.


Appears that most of Russia's salmon aquaculture occurs in the Barents Sea in the Murmansk region.  Trout are in the White Seas and lakes of the Republic of Karelia (not sure if this is freshwater).  There are multiple salmon sites within the region, but we do not have specific locations.

 - No info at all, needs to be fully gapfilled

```{r}


# farms_russia <- data.frame(lon=c(33.7149),
#                     lat=c(69.4953)) %>%
#   mutate(iso3c = "RUS") %>%
#   mutate(data_quality = 1) %>%
#   mutate(action_needed = "country based suitability")
# 
# write_csv(farms_russia, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_russia.csv"))

# Write a file for russia to indicate it has no information and will need to be fully gapfilled
rus_gf <- data.frame(iso3c = "RUS", type = "salmon", num_additional_farms = NA, data_quality = 1)
write_csv(rus_gf, here("marine/salmon/salmon_farm/data/no_info_1/gf_rus.csv"))
```


# Japan
We are using the ASC map data for Japan farms. 

Source: 
Aquaculture Stewardship Council Data Mapping Study, n.d. Aquaculture Stewardship Council. [Accessed November 11, 2020] 
https://gis.asc-aqua.org/arcgis_app/

```{r}
ASC_salmon_sf <- st_read(file.path("/home/shares/food-systems/Food_footprint/_raw_data/Aquaculture_locations/ASC_data/ASC_all_sf.shp"))

JPN_salmon_sf <- ASC_salmon_sf %>%
  dplyr::filter(crt_cnt == "Japan") %>%
  dplyr::filter(aq_grop == "salmonids")

mapview(JPN_salmon_sf)

JPN_pts <- st_centroid(JPN_salmon_sf)

JPN_pts_latlon <- st_transform(JPN_pts, crs = "+init=epsg:4326") %>% 
  dplyr::select(geometry) %>%
  mutate(iso3c = "JPN")

farms_JPN <- data.frame(do.call(rbind, st_geometry(JPN_pts_latlon))) 
names(farms_JPN) <- c("lon", "lat")
farms_all_JPN <- farms_JPN %>%
  cbind(iso3c = JPN_pts_latlon$iso3c) %>%
  mutate(data_quality = 2)

write_csv(farms_all_JPN, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_japan.csv"))

```


# Denmark
I've found some good information on farms in Denmark. There is a HELCOM dataset with finfish locations, and there are 20 farms. Other sources indicate there are 19 salmon specific farms in Denmark, which seems close enough to me. 

Columns of interest: 
 - geometry to get lat/lon
 - PR_AV_TON : Average tonnes of production per year

Source: 
HELCOM HOLAS II Dataset: Finfish mariculture, 2017. The Baltic Marine Environment Protection Commission. [Accessed October 12, 2020]



```{r}

enc <- readr::guess_encoding(file.path(path, "HELCOM_Baltic/Finfish_mariculture.shp"), n_max = 1000)[,"encoding"] %>% as.character()

# lat long estimates from google earth
farms_denmark <- st_read(file.path(path, "HELCOM_Baltic/Finfish_mariculture.shp"), options = "ENCODING=WINDOWS-1252") %>%
  filter(COUNTRY == "DK")

mapview(farms_denmark$geometry)

dk_pts <- st_centroid(farms_denmark)

dk_pts_latlon <- st_transform(dk_pts, crs = "+init=epsg:4326") %>% 
  dplyr::select(geometry, NAME)

dk_subregions <- dk_pts_latlon %>%
  dplyr::select(NAME)

farms_dk <- data.frame(do.call(rbind, st_geometry(dk_pts_latlon))) 
names(farms_dk) <- c("lon", "lat")
farms_dk <- farms_dk %>%
  mutate(iso3c="DNK") 

farms_dk <- cbind(farms_dk, dk_subregions ) %>%
  dplyr::select(lon, lat, iso3c, subregion = NAME) %>%
  mutate(data_quality = 5) 

write.csv(farms_dk, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_denmark.csv"), row.names = FALSE)

#farms_dk <- read_csv(here("aquaculture/marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_denmark.csv"))
```


# Turkey
There is salmon and trout aquaculture in Turkey. 

http://www.fao.org/fishery/countrysector/naso_turkey/en
14 Trout and seabass farms, 6 trout farms, 1 seabass and bream and trout,  
Based on this, we will treat the FAO as truth… and spatially allocate 21 farms. 


 - comprehensive - need to spatially allocate 21 farms randomly in turkey 

```{r}

farms_turkey <- data.frame(iso3c = "TUR", type = "salmon", num_additional_farms = 21, data_quality = 3)


write_csv(farms_turkey, here("marine/salmon/salmon_farm/data/known_number_farms_3/farms_tur.csv"))

```


# Finland
 - Comprehensive data

Source: 
HELCOM HOLAS II Dataset: Finfish mariculture, 2017. The Baltic Marine Environment Protection Commission. [Accessed October 12, 2020]

```{r}

enc <- readr::guess_encoding(file.path(path, "HELCOM_Baltic/Finfish_mariculture.shp"), n_max = 1000)[,"encoding"] %>% as.character()

# lat long estimates from google earth
farms_fin <- st_read(file.path(path, "HELCOM_Baltic/Finfish_mariculture.shp"), options = "ENCODING=WINDOWS-1252") %>%
  filter(COUNTRY == "FI")

mapview(farms_fin$geometry)

fi_pts <- st_centroid(farms_fin)

fi_pts_latlon <- st_transform(fi_pts, crs = "+init=epsg:4326") %>% 
  dplyr::select(geometry, NAME)

fi_subregions <- fi_pts_latlon %>%
  dplyr::select(NAME)

farms_fi <- data.frame(do.call(rbind, st_geometry(fi_pts_latlon))) 
names(farms_fi) <- c("lon", "lat")
farms_fi <- farms_fi %>%
  mutate(iso3c="FIN") 

farms_fi <- cbind(farms_fi, fi_subregions ) %>%
  dplyr::select(lon, lat, iso3c, subregion = NAME) %>%
  mutate(data_quality = 5)

write.csv(farms_fi, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_finland.csv"), row.names = FALSE)

farms_fi <- read_csv(here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_finland.csv"))
```

# Sweden 

 - Comprehensive data
 
Source:
HELCOM HOLAS II Dataset: Finfish mariculture, 2017. The Baltic Marine Environment Protection Commission. [Accessed October 12, 2020]

```{r}

enc <- readr::guess_encoding(file.path(path, "HELCOM_Baltic/Finfish_mariculture.shp"), n_max = 1000)[,"encoding"] %>% as.character()

# lat long estimates from google earth
farms_swe <- st_read(file.path(path, "HELCOM_Baltic/Finfish_mariculture.shp"), options = "ENCODING=WINDOWS-1252") %>%
  filter(COUNTRY == "SE") %>%
  dplyr::filter(PRODUCTION %in% c("Rainbow trout (Oncorhynchus mykiss)", "Salmon, Rainbow trout (Oncorhynchus mykiss), Char (salvelinus)", "Salmon, Trout (Salmo trutta)", "Salmon", "Salmon, Trout (Salmo trutta), Rainbow trout (Oncorhynchus mykiss), Char (salvelinus)", "Perch (perca fluviatilis), Pikeperch (Sander lucioperca), Rainbow trout (Oncorhynchus mykiss)", "Trout (Salmo trutta)", "Salmon, Trout (Salmo trutta) - breeding", "Perch (perca fluviatilis), Grayling (thymallus thymallus), Rainbow trout (Oncorhynchus mykiss), Char (salvelinus), tropical fish species"))

mapview(farms_swe$geometry)

unique(farms_swe$PRODUCTION)

sw_pts <- st_centroid(farms_swe)

sw_pts_latlon <- st_transform(sw_pts, crs = "+init=epsg:4326") %>% 
  dplyr::select(geometry, NAME)

sw_subregions <- sw_pts_latlon %>%
  dplyr::select(NAME)

farms_sw <- data.frame(do.call(rbind, st_geometry(sw_pts_latlon))) 
names(farms_sw) <- c("lon", "lat")
farms_sw <- farms_sw %>%
  mutate(iso3c="SWE") 

farms_sw <- cbind(farms_sw, sw_subregions ) %>%
  dplyr::select(lon, lat, iso3c, subregion = NAME) %>%
  filter(!is.na(lat)) %>%
  mutate(data_quality = 5) 

write.csv(farms_sw, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_sweden.csv"), row.names = FALSE)

#farms_sw <- read_csv(here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_sweden.csv"))
```

## Iceland

We are using the ASC data for this, however this is only a subset of farms in Iceland. We will treat this as needed to be gapfilled with existing points (data_quality = 2)

Source: 
Aquaculture Stewardship Council Data Mapping Study, n.d. Aquaculture Stewardship Council. [Accessed November 11, 2020] 
https://gis.asc-aqua.org/arcgis_app/

```{r}
ASC_salmon_sf <- st_read(file.path("/home/shares/food-systems/Food_footprint/_raw_data/Aquaculture_locations/ASC_data/ASC_all_sf.shp"))

ISL_salmon_sf <- ASC_salmon_sf %>%
  dplyr::filter(crt_cnt == "Iceland")

mapview(ISL_salmon_sf)

ISL_pts <- st_centroid(ISL_salmon_sf)

ISL_pts_latlon <- st_transform(ISL_pts, crs = "+init=epsg:4326") %>% 
  dplyr::select(geometry) %>%
  mutate(iso3c = "ISL")

farms_ISL <- data.frame(do.call(rbind, st_geometry(ISL_pts_latlon))) 
names(farms_ISL) <- c("lon", "lat")
farms_all_ISL <- farms_ISL %>%
  cbind(iso3c = ISL_pts_latlon$iso3c) %>%
  mutate(data_quality = 2)

write_csv(farms_all_ISL, here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5/farms_isl.csv"))

```

# Join cell count dataframes

```{r}

farm_files <- list.files(here("marine/salmon/salmon_farm/data/known_farm_sites_2_4_5"), full=TRUE)
all_farms = plyr::ldply(farm_files, read_csv)

all_farms_1 <- all_farms %>%
  dplyr::select(-data_quality)

write.csv(all_farms_1, here("marine/salmon/salmon_farm/data/global_salmon_farm_lat_lon.csv"), row.names = FALSE)

write.csv(all_farms, here("marine/salmon/salmon_farm/data/global_salmon_farm_lat_lon_quality.csv"), row.names = FALSE)

# all_farms <- read_csv(here("marine/salmon/salmon_farm/data/global_salmon_farm_lat_lon_quality.csv"), col_types = "ddccd")

all_farms_sf <- st_as_sf(all_farms, coords = c("lon", "lat"), 
                         crs = crs(gadm_latlon), agr = "constant")

mapview(all_farms_sf)

unique(all_farms$iso3c)
```


